import{l as ie,a as L,u as re,c as se}from"./thing-6c3202c7.js";import{l as de}from"./classification-294be7c5.js";import{l as ce}from"./tag-10fcd536.js";import{k as o,M as ue,d as pe,b as O,z as S,j as fe,r as d,o as h,e as b,f as _,s as n,I as w,x as me,g as l,F as ge,l as _e,c as A,t as ve,E as he,B as ye,m as y,p as we,h as be}from"./index-f6b5f6b4.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"};const Ie=ke;function B(c){for(var u=1;u<arguments.length;u++){var p=arguments[u]!=null?Object(arguments[u]):{},f=Object.keys(p);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(p).filter(function(r){return Object.getOwnPropertyDescriptor(p,r).enumerable}))),f.forEach(function(r){Ce(c,r,p[r])})}return c}function Ce(c,u,p){return u in c?Object.defineProperty(c,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[u]=p,c}var D=function(u,p){var f=B({},u,p.attrs);return o(ue,B({},f,{icon:Ie}),null)};D.displayName="FileImageOutlined";D.inheritAttrs=!1;const Fe=D,E=c=>(we("data-v-33993f3f"),c=c(),be(),c),Oe={class:"page-view"},Se={class:"table-operations"},De={key:0},Ue=["onClick"],ze=E(()=>_("a",{href:"#"},"删除",-1)),Re={class:"ant-upload-drag-icon"},Le=["src"],Ae=E(()=>_("p",{class:"ant-upload-text"}," 请选择要上传的封面图片 ",-1)),Be=pe({__name:"thing",setup(c){const u=O([{title:"序号",dataIndex:"index",key:"index",width:60},{title:"名称",dataIndex:"title",key:"title"},{title:"价格",dataIndex:"price",key:"price"},{title:"状态",dataIndex:"status",key:"status",customRender:({text:a,record:t,index:s,column:I})=>a==="0"?"上架":"下架"},{title:"库存",dataIndex:"repertory",key:"repertory"},{title:"简介",dataIndex:"description",key:"description",customRender:({text:a,record:t,index:s,column:I})=>a?a.substring(0,10)+"...":"--"},{title:"操作",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:140}]),p=a=>{const t=new Date().getTime().toString()+"."+a.type.substring(6),s=new File([a],t);return console.log(s),e.form.imageFile=s,!1},f=S([]),r=O({dataList:[],loading:!1,keyword:"",selectedRowKeys:[],pageSize:10,page:1}),e=O({visile:!1,editFlag:!1,title:"",cData:[],tagData:[{}],form:{id:void 0,title:void 0,classificationId:void 0,tags:[],repertory:void 0,price:void 0,status:void 0,cover:void 0,coverUrl:void 0,imageFile:void 0},rules:{title:[{required:!0,message:"请输入名称",trigger:"change"}],classificationId:[{required:!0,message:"请选择分类",trigger:"change"}],repertory:[{required:!0,message:"请输入库存",trigger:"change"}],price:[{required:!0,message:"请输入定价",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}}),x=S();fe(()=>{v(),$(),M()});const v=()=>{r.loading=!0,ie({keyword:r.keyword}).then(a=>{r.loading=!1,console.log(a),a.data.forEach((t,s)=>{t.index=s+1}),r.dataList=a.data}).catch(a=>{r.loading=!1,console.log(a)})},$=()=>{de({}).then(a=>{e.cData=a.data})},M=()=>{ce({}).then(a=>{a.data.forEach((t,s)=>{t.index=s+1}),e.tagData=a.data})},V=a=>{var t;r.keyword=(t=a==null?void 0:a.target)==null?void 0:t.value,console.log(r.keyword)},j=()=>{v()},N=S({onChange:(a,t)=>{console.log(`selectedRowKeys: ${a}`,"selectedRows: ",t),r.selectedRowKeys=a}}),q=()=>{U(),e.visile=!0,e.editFlag=!1,e.title="新增";for(const a in e.form)e.form[a]=void 0;e.form.cover=void 0},K=a=>{U(),e.visile=!0,e.editFlag=!0,e.title="编辑";for(const t in e.form)e.form[t]=void 0;for(const t in a)a[t]&&(e.form[t]=a[t]);e.form.cover&&(e.form.coverUrl=ye+"/api/staticfiles/image/"+e.form.cover,e.form.cover=void 0)},P=a=>{console.log("delete",a),L({ids:a.id}).then(t=>{v()}).catch(t=>{y.error(t.msg||"操作失败")})},H=()=>{if(console.log(r.selectedRowKeys),r.selectedRowKeys.length<=0){console.log("hello"),y.warn("请勾选删除项");return}L({ids:r.selectedRowKeys.join(",")}).then(a=>{y.success("删除成功"),r.selectedRowKeys=[],v()}).catch(a=>{y.error(a.msg||"操作失败")})},T=()=>{var a;(a=x.value)==null||a.validate().then(()=>{const t=new FormData;e.editFlag&&t.append("id",e.form.id),t.append("title",e.form.title),e.form.classificationId&&t.append("classificationId",e.form.classificationId),e.form.tags&&e.form.tags.forEach(function(s){s&&t.append("tags[]",s)}),e.form.imageFile&&t.append("imageFile",e.form.imageFile),t.append("description",e.form.description||""),t.append("price",e.form.price||""),e.form.repertory>=0&&t.append("repertory",e.form.repertory),e.form.status&&t.append("status",e.form.status),e.editFlag?re(t).then(s=>{k(),v()}).catch(s=>{console.log(s),y.error(s.msg||"操作失败")}):se(t).then(s=>{k(),v()}).catch(s=>{console.log(s),y.error(s.msg||"操作失败")})}).catch(t=>{console.log("不能为空")})},G=()=>{k()},U=()=>{var a;(a=x.value)==null||a.resetFields(),f.value=[]},k=()=>{e.visile=!1};return(a,t)=>{const s=d("a-button"),I=d("a-input-search"),J=d("a-space"),Q=d("a-divider"),W=d("a-popconfirm"),X=d("a-table"),Y=d("a-input"),m=d("a-form-item"),g=d("a-col"),C=d("a-select"),F=d("a-select-option"),Z=d("a-upload-dragger"),ee=d("a-textarea"),z=d("a-input-number"),te=d("a-row"),ae=d("a-form"),oe=d("a-modal");return h(),b("div",null,[_("div",Oe,[_("div",Se,[o(J,null,{default:n(()=>[o(s,{type:"primary",onClick:q},{default:n(()=>[w("新增")]),_:1}),o(s,{onClick:H},{default:n(()=>[w("批量删除")]),_:1}),o(I,{"addon-before":"名称","enter-button":"",onSearch:j,onChange:V})]),_:1})]),o(X,{size:"middle",rowKey:"id",loading:l(r).loading,columns:l(u),"data-source":l(r).dataList,scroll:{x:"max-content"},"row-selection":l(N),pagination:{size:"default",current:l(r).page,pageSize:l(r).pageSize,onChange:i=>l(r).page=i,showSizeChanger:!1,showTotal:i=>`共${i}条数据`}},{bodyCell:n(({text:i,record:R,index:Ee,column:le})=>[le.key==="operation"?(h(),b("span",De,[_("a",{onClick:ne=>K(R)},"编辑",8,Ue),o(Q,{type:"vertical"}),o(W,{title:"确定删除?","ok-text":"是","cancel-text":"否",onConfirm:ne=>P(R)},{default:n(()=>[ze]),_:2},1032,["onConfirm"])])):me("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])]),_("div",null,[o(oe,{visible:l(e).visile,forceRender:!0,title:l(e).title,width:"880px","ok-text":"确认","cancel-text":"取消",onCancel:G,onOk:T},{default:n(()=>[_("div",null,[o(ae,{ref_key:"myform",ref:x,"label-col":{style:{width:"80px"}},model:l(e).form,rules:l(e).rules},{default:n(()=>[o(te,{gutter:24},{default:n(()=>[o(g,{span:"24"},{default:n(()=>[o(m,{label:"商品名称",name:"title"},{default:n(()=>[o(Y,{placeholder:"请输入",value:l(e).form.title,"onUpdate:value":t[0]||(t[0]=i=>l(e).form.title=i)},null,8,["value"])]),_:1})]),_:1}),o(g,{span:"12"},{default:n(()=>[o(m,{label:"分类",name:"classificationId"},{default:n(()=>[o(C,{placeholder:"请选择",allowClear:"",options:l(e).cData,"field-names":{label:"title",value:"id"},value:l(e).form.classificationId,"onUpdate:value":t[1]||(t[1]=i=>l(e).form.classificationId=i)},null,8,["options","value"])]),_:1})]),_:1}),o(g,{span:"12"},{default:n(()=>[o(m,{label:"标签"},{default:n(()=>[o(C,{mode:"multiple",placeholder:"请选择",allowClear:"",value:l(e).form.tags,"onUpdate:value":t[2]||(t[2]=i=>l(e).form.tags=i)},{default:n(()=>[(h(!0),b(ge,null,_e(l(e).tagData,i=>(h(),A(F,{value:i.id},{default:n(()=>[w(ve(i.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1}),o(g,{span:"24"},{default:n(()=>[o(m,{label:"封面"},{default:n(()=>[o(Z,{name:"file",accept:"image/*",multiple:!1,"before-upload":p,"file-list":l(f),"onUpdate:file-list":t[3]||(t[3]=i=>he(f)?f.value=i:null)},{default:n(()=>[_("p",Re,[l(e).form.coverUrl?(h(),b("img",{key:0,src:l(e).form.coverUrl,style:{width:"60px",height:"80px"}},null,8,Le)):(h(),A(l(Fe),{key:1}))]),Ae]),_:1},8,["file-list"])]),_:1})]),_:1}),o(g,{span:"24"},{default:n(()=>[o(m,{label:"内容简介"},{default:n(()=>[o(ee,{placeholder:"请输入",value:l(e).form.description,"onUpdate:value":t[4]||(t[4]=i=>l(e).form.description=i)},null,8,["value"])]),_:1})]),_:1}),o(g,{span:"12"},{default:n(()=>[o(m,{label:"定价",name:"price"},{default:n(()=>[o(z,{placeholder:"请输入",min:0,value:l(e).form.price,"onUpdate:value":t[5]||(t[5]=i=>l(e).form.price=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),o(g,{span:"12"},{default:n(()=>[o(m,{label:"状态",name:"status"},{default:n(()=>[o(C,{placeholder:"请选择",allowClear:"",value:l(e).form.status,"onUpdate:value":t[6]||(t[6]=i=>l(e).form.status=i)},{default:n(()=>[o(F,{key:"0",value:"0"},{default:n(()=>[w("上架")]),_:1}),o(F,{key:"1",value:"1"},{default:n(()=>[w("下架")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(g,{span:"12"},{default:n(()=>[o(m,{label:"库存",name:"repertory"},{default:n(()=>[o(z,{placeholder:"请输入",min:0,value:l(e).form.repertory,"onUpdate:value":t[7]||(t[7]=i=>l(e).form.repertory=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["visible","title"])])])}}});const qe=xe(Be,[["__scopeId","data-v-33993f3f"]]);export{qe as default};
