import{d as j,u as E,y as H,a as O,b as N,z,j as J,r as c,o as k,e as y,k as n,f as e,g as o,t as m,w as L,v as T,s as d,A as I,m as u,p as G,h as K}from"./index-f6b5f6b4.js";import{H as Q}from"./header-ce1ba502.js";import{c as W}from"./order-3fcb79be.js";import{l as X,c as Y}from"./address-32a3c403.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./notice-502f1323.js";import"./k-logo-98944f67.js";const ee=""+new URL("delete-icon-3bb01267.svg",import.meta.url).href,v=p=>(G("data-v-dde5c33b"),p=p(),K(),p),se={class:"cart-page flex-view"},te={class:"left-flex"},ae=v(()=>e("div",{class:"title flex-view"},[e("h3",null,"订单明细")],-1)),oe={class:"cart-list-view"},ie=I('<div class="list-th flex-view" data-v-dde5c33b><span class="line-1" data-v-dde5c33b>商品名称</span><span class="line-2" data-v-dde5c33b>价格</span><span class="line-5" data-v-dde5c33b>数量</span><span class="line-6" data-v-dde5c33b>操作</span></div>',1),ne={class:"list"},de={class:"items flex-view"},le={class:"book flex-view"},re=["src"],ce={class:"pay"},ve=["src"],me=v(()=>e("div",{class:"title flex-view"},[e("h3",null,"备注")],-1)),ue={class:"right-flex"},pe=v(()=>e("div",{class:"title flex-view"},[e("h3",null,"收货地址")],-1)),_e={class:"address-view"},fe={class:"info",style:{}},he=v(()=>e("span",null,"收件人：",-1)),be={class:"name"},ge={class:"tel"},we={key:0,class:"address"},xe={key:1,class:"info"},ke=v(()=>e("span",null,"目前暂无地址信息，请",-1)),ye=v(()=>e("div",{class:"title flex-view"},[e("h3",null,"结算"),e("span",{class:"click-txt"},"价格")],-1)),Ae={class:"price-view"},Ce={class:"price-item flex-view"},Ne=v(()=>e("div",{class:"item-name"},"商品总价",-1)),Ie={class:"price-txt"},De=I('<div class="price-item flex-view" data-v-dde5c33b><div class="item-name" data-v-dde5c33b>商品优惠</div><div class="price-txt" data-v-dde5c33b>¥0</div></div><div class="price-item flex-view" data-v-dde5c33b><div class="item-name" data-v-dde5c33b>商品折扣</div><div class="price-txt" data-v-dde5c33b>¥0</div></div>',2),Ue={class:"total-price-view flex-view"},Pe=v(()=>e("span",null,"合计",-1)),Se={class:"price"},qe={class:"font-big"},Fe={class:"btns-view"},Be=j({__name:"confirm",setup(p){const A=E(),_=H(),f=O(),s=N({id:void 0,title:void 0,cover:void 0,price:void 0,remark:void 0,count:1,amount:void 0,receiverName:void 0,receiverPhone:void 0,receiverAddress:void 0}),a=N({visile:!1,editFlag:!1,title:"",form:{name:void 0,mobile:void 0,desc:void 0,default:void 0},rules:{name:[{required:!0,message:"请输入",trigger:"change"}]}}),w=z();J(()=>{s.id=_.query.id,s.title=_.query.title,s.cover=_.query.cover,s.price=_.query.price,s.amount=s.price,F()});const D=()=>{S(),a.visile=!0,a.editFlag=!1,a.title="新增";for(const i in a.form)a.form[i]=void 0},U=()=>{var i;if(!f.user_id){u.warn("请先登录");return}(i=w.value)==null||i.validate().then(()=>{const t=new FormData;t.append("userId",f.user_id),t.append("def",a.form.default?"1":"0"),a.form.name&&t.append("name",a.form.name),a.form.mobile&&t.append("mobile",a.form.mobile),a.form.desc&&t.append("description",a.form.desc),Y(t).then(l=>{console.log(l),C(),s.receiverName=a.form.name,s.receiverAddress=a.form.desc,s.receiverPhone=a.form.mobile}).catch(l=>{u.error(l.msg||"新建失败")})}).catch(t=>{console.log(t),console.log("不能为空")})},P=()=>{C()},S=()=>{var i;(i=w.value)==null||i.resetFields()},C=()=>{a.visile=!1},q=i=>{s.amount=s.price*i},F=()=>{let i=f.user_id;X({userId:i}).then(t=>{t.data.length>0&&(s.receiverName=t.data[0].name,s.receiverPhone=t.data[0].mobile,s.receiverAddress=t.data[0].description,t.data.forEach(l=>{l.default&&(s.receiverName=l.name,s.receiverPhone=l.mobile,s.receiverAddress=l.description)}))}).catch(t=>{console.log(t)})},B=()=>{A.back(),console.log("back...")},M=()=>{const i=new FormData;let t=f.user_id;if(!t){u.warn("请先登录！");return}if(!s.receiverName){u.warn("请选择地址！");return}i.append("userId",t),i.append("thingId",s.id),i.append("count",s.count),s.remark&&i.append("remark",s.remark),i.append("receiverName",s.receiverName),i.append("receiverPhone",s.receiverPhone),i.append("receiverAddress",s.receiverAddress),console.log(i),W(i).then(l=>{u.success("请支付订单"),A.push({name:"pay",query:{amount:s.amount}})}).catch(l=>{u.error(l.msg||"失败")})};return(i,t)=>{const l=c("a-input-number"),x=c("a-input"),h=c("a-form-item"),b=c("a-col"),g=c("a-row"),R=c("a-switch"),V=c("a-form"),$=c("a-modal");return k(),y("div",null,[n(Q),e("section",se,[e("div",te,[ae,e("div",oe,[ie,e("div",ne,[e("div",de,[e("div",le,[e("img",{src:o(s).cover},null,8,re),e("h2",null,m(o(s).title),1)]),e("div",ce,"¥"+m(o(s).price),1),n(l,{value:o(s).count,"onUpdate:value":t[0]||(t[0]=r=>o(s).count=r),min:1,max:10,onChange:q},null,8,["value"]),e("img",{src:o(ee),class:"delete"},null,8,ve)])])]),me,L(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>o(s).remark=r),placeholder:"输入备注信息，100字以内",class:"remark"},`\r
    `,512),[[T,o(s).remark]])]),e("div",ue,[pe,e("div",_e,[e("div",fe,[he,e("span",be,m(o(s).receiverName),1),e("span",ge,m(o(s).receiverPhone),1)]),o(s).receiverAddress?(k(),y("div",we,m(o(s).receiverAddress),1)):(k(),y("div",xe,[ke,e("span",{class:"info-blue",onClick:D},"新建地址")]))]),ye,e("div",Ae,[e("div",Ce,[Ne,e("div",Ie,"¥"+m(o(s).amount),1)]),De,e("div",Ue,[Pe,e("div",Se,[e("span",qe,"¥"+m(o(s).amount),1)])]),e("div",Fe,[e("button",{class:"btn buy",onClick:t[2]||(t[2]=r=>B())},"返回"),e("button",{class:"btn pay jiesuan",onClick:t[3]||(t[3]=r=>M())},"结算")])])])]),e("div",null,[n($,{visible:o(a).visile,forceRender:!0,title:o(a).title,"ok-text":"确认","cancel-text":"取消",onCancel:P,onOk:U},{default:d(()=>[n(V,{ref_key:"myform",ref:w,"label-col":{style:{width:"80px"}},model:o(a).form,rules:o(a).rules},{default:d(()=>[n(g,{gutter:24},{default:d(()=>[n(b,{span:"24"},{default:d(()=>[n(h,{label:"姓名",name:"name"},{default:d(()=>[n(x,{placeholder:"请输入",value:o(a).form.name,"onUpdate:value":t[4]||(t[4]=r=>o(a).form.name=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),n(g,{gutter:24},{default:d(()=>[n(b,{span:"24"},{default:d(()=>[n(h,{label:"电话号码",name:"mobile"},{default:d(()=>[n(x,{placeholder:"请输入",value:o(a).form.mobile,"onUpdate:value":t[5]||(t[5]=r=>o(a).form.mobile=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),n(g,{gutter:24},{default:d(()=>[n(b,{span:"24"},{default:d(()=>[n(h,{label:"送货地址",name:"desc"},{default:d(()=>[n(x,{placeholder:"请输入",value:o(a).form.desc,"onUpdate:value":t[6]||(t[6]=r=>o(a).form.desc=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),n(g,{gutter:24},{default:d(()=>[n(b,{span:"24"},{default:d(()=>[n(h,{label:"默认地址"},{default:d(()=>[n(R,{checked:o(a).form.default,"onUpdate:checked":t[7]||(t[7]=r=>o(a).form.default=r)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title"])])])}}});const Oe=Z(Be,[["__scopeId","data-v-dde5c33b"]]);export{Oe as default};
